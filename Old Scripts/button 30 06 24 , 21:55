local Button = {}
Button.__index = Button

Button.NumberOfInstances = 0

function Button.new(object, instanceTool)
	Button.NumberOfInstances += 1
	
	local self = setmetatable({}, Button)
	self.InstanceID = Button.NumberOfInstances
	self.Object = object

	self.InstanceTool = instanceTool
	self.BoxPath = self.Object:GetBox(self.InstanceTool)
	self.Box = self.BoxPath.Box

	return self
end

function Button:Init()	
	-- First prompt creation
	self.Prompt = self.Box.Base.Attachment:FindFirstChild("ProximityPrompt") or self:CreatePrompt() 

	self.Connection = self.Prompt.Triggered:Connect(function(...)
		self:Press(...)
	end)	
	
	self.Subscription = self.Object:SubscribeTopic("BoxDropped", function(...)
		local boxIndex = self.Object:GetBox(...).boxIndex
		if self.BoxPath.boxIndex == boxIndex then
			self:OnClientToServer(...)
		end	
	end)
end

function Button:OnClientToServer(...)

	self.Prompt = self:CreatePrompt()
	self.Connection = self.Prompt.Triggered:Connect(function(...)
		local player = ...
		print("INSTANCIA/OBJETO: " .. tostring(self.InstanceID) .. "de: " .. player.Name .. " Trigger.")
		self:Press(...)
	end)		
end

function Button:CreatePrompt()
	local Prompt = Instance.new("ProximityPrompt")
	Prompt.HoldDuration = 0.5
	Prompt.Parent = self.Box.Base.Attachment

	return Prompt
end

function Button:Press(player)
	self.Object:SetBox(player, self.Box)	
	self.Connection:Disconnect()
	self.Prompt:Destroy()
end

return Button
