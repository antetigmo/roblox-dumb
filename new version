local Button = {}
Button.__index = Button

Button.NumberOfInstances = 0

function Button.new(object, instanceTool)
	Button.NumberOfInstances += 1
	local self = setmetatable({}, Button)
	self.InstanceID = Button.NumberOfInstances
	self.Object = object

	self.InstanceTool = instanceTool
	self.BoxPath = self.Object:GetBox(self.InstanceTool)
	self.Box = self.BoxPath.Box

	self.Connection = nil
	
	return self
end

function Button:Init()	
	-- First prompt creation
	self.Prompt = self.Box.Base.Attachment:FindFirstChild("ProximityPrompt") or self:CreatePrompt() 

	self.Connection = self.Prompt.Triggered:Connect(function(...)
		self:Press(...)
	end)	
	
	self.Subscription = self.Object:SubscribeTopic("BoxDropped", function(...)
		local boxIndex = self.Object:GetBox(...).boxIndex
		print(self.InstanceID, boxIndex)
		if self.InstanceID == boxIndex then
			self:OnClientToServer(...)
		end	
	end)
end

function Button:OnClientToServer(player)
	self.Prompt = self:CreatePrompt()
	self.Connection = self.Prompt.Triggered:Connect(function(...)
		self:Press(...)
	end)		
end

function Button:CreatePrompt()
	local Prompt = Instance.new("ProximityPrompt")
	Prompt.HoldDuration = 0.5
	Prompt.Parent = self.Box.Base.Attachment

	return Prompt
end

function Button:Press(player)		
	self.Object:SetBox(player, self.Box)	
	self.Connection:Disconnect()
	self.Prompt:Destroy()
end

-- MAS É ESQUESITO PORQUE TIPO, O MODULO Button É INSTANCIADO PRA CADA CAIXA, LOGO TODAS AS CAIXAS NÃO IRIAM PREICSAR
-- DE UM ID JA QUE SERIAM CRIADAS EM MOMENTOS DIFERENTES, TIPO A CAIXA 1 TERIA O MODULO Button 1.
-- E A 2 IRIA ADICIONAR AO NumberOfInstances += 1 E JA QUE ELA FOI CRIADA DEPOIS DO 1, ELA VAI RECEBER O ID 2
-- PORQUE ISSO NAO SE APLICA AQUI?

return Button
